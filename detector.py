# from __future__ import print_function
import zmq as z
import struct
import time,sys

import pickle
import pandas as pd
import numpy as np
from sklearn.preprocessing import LabelEncoder, OneHotEncoder


# flush stdout and get context from C program
sys.stdout.flush()
context = z.Context()

# Connect to socket
topic = "data".encode('ascii')
socket = context.socket(z.REQ)
socket.connect("tcp://127.0.0.1:5555")
print("connected")
model = pickle.load(open("model.pickle.dat", "rb"))

#le = LabelEncoder()
#
while True:
    # get string from socket
    #incoming_string_ohc = np.array(str(socket.recv_string()))
    data = socket.recv()
    print(data)
    incoming_string_ohc = np.array(str(data))
    #arr = np.array([incoming_string_ohc])
    #encoded = le.fit_transform(arr[0])
    # get prediction
    pred = model.predict(incoming_string_ohc)
    socket.send(str(pred))

